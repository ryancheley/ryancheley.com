<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <title>Web Scrapping - Passer Data (Part III)</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="In Part III I'm reviewing the code to populate a DataFrame with Passer data from the current NFL season. To start I use the games DataFrame I..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">My Place on the Internet</a></h1>
                <nav><ul>
                    <li><a href="/category/apple.html">Apple</a></li>
                    <li><a href="/category/automation.html">Automation</a></li>
                    <li><a href="/category/books.html">Books</a></li>
                    <li><a href="/category/coding.html">Coding</a></li>
                    <li><a href="/category/conferences.html">Conferences</a></li>
                    <li><a href="/category/conferenes.html">Conferenes</a></li>
                    <li><a href="/category/django.html">Django</a></li>
                    <li><a href="/category/github.html">GitHub</a></li>
                    <li><a href="/category/ios.html">iOS</a></li>
                    <li><a href="/category/macos.html">macOS</a></li>
                    <li><a href="/category/misc.html">misc</a></li>
                    <li><a href="/category/music.html">Music</a></li>
                    <li><a href="/category/musings.html">Musings</a></li>
                    <li><a href="/category/podcasts.html">Podcasts</a></li>
                    <li><a href="/category/productivity.html">Productivity</a></li>
                    <li><a href="/category/professional-development.html">Professional Development</a></li>
                    <li><a href="/category/python.html">Python</a></li>
                    <li><a href="/category/raspberry-pi.html">Raspberry Pi</a></li>
                    <li><a href="/category/server.html">Server</a></li>
                    <li class="active"><a href="/category/sports.html">Sports</a></li>
                    <li><a href="/category/web.html">Web</a></li>
                    <li><a href="/category/writing.html">Writing</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/web-scrapping-passer-data-part-iii.html" rel="bookmark"
           title="Permalink to Web Scrapping - Passer Data (Part III)">Web Scrapping - Passer Data (Part III)</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-11-19T17:25:00+01:00">
                Published: Sat 19 November 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/ryan.html">ryan</a>
        </address>
<p>In <a href="/category/sports.html">Sports</a>.</p>
<p>tags: <a href="/tag/nfl.html">nfl</a> <a href="/tag/python.html">python</a> </p>
</footer><!-- /.post-info -->      <p>In Part III I'm reviewing the code to populate a DataFrame with Passer data from the current NFL season.</p>
<p>To start I use the <code>games</code> <code>DataFrame</code> I created in <a href="https://www.ryancheley.com/blog/2016/11/18/web-scrapping-passer-data-part-ii">Part II</a> to create 4 new <code>DataFrames</code>:</p>
<ul>
<li>reg_season_games - All of the Regular Season Games</li>
<li>pre_season_games - All of the Pre Season Games</li>
<li>gameshome - The Home Games</li>
<li>gamesaway - The Away Games</li>
</ul>
<p>A cool aspect of the DataFrames is that you can treat them kind of like temporary tables (at least, this is how I'm thinking about them as I am mostly a <code>SQL</code> programmer) and create other temporary tables based on criteria. In the code below I'm taking the <code>nfl_start_date</code> that I defined in <a href="https://www.ryancheley.com/blog/2016/11/18/web-scrapping-passer-data-part-ii">Part II</a> as a way to split the data frame into pre / and regular season <code>DataFrame</code>. I then take the regular season <code>DataFrame</code> and split that into home and away <code>DataFrames</code>. I do this so I don't double count the statistics for the passers.</p>
<div class="highlight"><pre><span></span><code><span class="p">#</span><span class="n">Start</span> <span class="n">Section</span> <span class="mh">3</span>

<span class="n">reg_season_games</span> <span class="o">=</span> <span class="n">games</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">games</span><span class="p">[&#39;</span><span class="n">match_date</span><span class="p">&#39;]</span> <span class="o">&gt;=</span> <span class="n">nfl_start_date</span><span class="p">]</span>
<span class="n">pre_season_games</span> <span class="o">=</span> <span class="n">games</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">games</span><span class="p">[&#39;</span><span class="n">match_date</span><span class="p">&#39;]</span> <span class="o">&lt;</span> <span class="n">nfl_start_date</span><span class="p">]</span>

<span class="n">gameshome</span> <span class="o">=</span> <span class="n">reg_season_games</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reg_season_games</span><span class="p">[</span><span class="mh">&#39;ha</span><span class="n">_ind</span><span class="p">&#39;]</span> <span class="o">==</span> <span class="p">&#39;</span><span class="n">vs</span><span class="p">&#39;]</span>
<span class="n">gamesaway</span> <span class="o">=</span> <span class="n">reg_season_games</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reg_season_games</span><span class="p">[</span><span class="mh">&#39;ha</span><span class="n">_ind</span><span class="p">&#39;]</span> <span class="o">==</span> <span class="sc">&#39;@&#39;</span><span class="p">]</span>
</code></pre></div>

<p>Next, I set up some variables to be used later:</p>
<div class="highlight"><pre><span></span><code><span class="n">BASE_URL</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">http</span><span class="err">:</span><span class="c1">//www.espn.com/nfl/boxscore/_/gameId/{0}&#39;</span>

<span class="err">#</span><span class="n">Create</span> <span class="n">the</span> <span class="n">lists</span> <span class="n">to</span> <span class="n">hold</span> <span class="n">the</span> <span class="n">values</span> <span class="n">for</span> <span class="n">the</span> <span class="n">games</span> <span class="n">for</span> <span class="n">the</span> <span class="n">passers</span>
<span class="n">player_pass_name</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_catch</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_attempt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_yds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_avg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_td</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_int</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_sacks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_sacks_yds_lost</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_rtg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_week_id</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_team</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_pass_ha_ind</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_match_id</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">player_id</span> <span class="o">=</span> <span class="p">[]</span> <span class="cp">#declare</span> <span class="n">the</span> <span class="n">player_id</span> <span class="n">as</span> <span class="n">a</span> <span class="n">list</span> <span class="n">so</span> <span class="n">it</span> <span class="n">doesn</span><span class="err">&#39;</span><span class="k">t</span> <span class="n">get</span> <span class="n">set</span> <span class="n">to</span> <span class="n">a</span> <span class="k">str</span> <span class="n">by</span> <span class="n">the</span> <span class="n">loop</span> <span class="n">below</span>

<span class="n">headers_pass</span> <span class="o">=</span> <span class="p">[</span><span class="err">&#39;</span><span class="n">match_id</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">id</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">Name</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">CATCHES</span><span class="err">&#39;</span><span class="p">,</span><span class="err">&#39;</span><span class="n">ATTEMPTS</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">YDS</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">AVG</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">TD</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">INT</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">SACKS</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">YRDLSTSACKS</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">RTG</span><span class="err">&#39;</span><span class="p">]</span>
</code></pre></div>

<p>Now it's time to start populating some of the <code>list</code> variables I created above. I am taking the <code>week_id</code>, <code>result</code>, <code>team_x</code>, and <code>ha_ind</code> columns from the <code>games</code> <code>DataFrame</code> (I'm sure there is a better way to do this, and I will need to revisit it in the future)</p>
<div class="highlight"><pre><span></span><code>player_pass_week_id.append(gamesaway.week_id)
player_pass_result.append(gamesaway.result)
player_pass_team.append(gamesaway.team_x)
player_pass_ha_ind.append(gamesaway.ha_ind)
</code></pre></div>

<p>Now for the looping (everybody's favorite part!). Using <code>BeautifulSoup</code> I get the <code>div</code> of class <code>col column-one gamepackage-away-wrap</code>. Once I have that I get the table rows and then loop through the data in the row to get what I need from the table holding the passer data. Some intersting things happening below:</p>
<ul>
<li>The Catches / Attempts and Sacks / Yrds Lost are displayed as a single column each (even though each column holds 2 statistics). In order to <em>fix</em> this I use the <code>index()</code> method and get all of the data to the left of a character (<code>-</code> and <code>/</code> respectively for each column previously mentioned) and append the resulting 2 items per column (so four in total) to 2 different lists (four in total).</li>
</ul>
<p>The last line of code gets the <a href="https://www.espn.com">ESPN</a> <code>player_id</code>, just in case I need/want to use it later.</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="nv">index</span>, <span class="nv">row</span> <span class="nv">in</span> <span class="nv">gamesaway</span>.<span class="nv">iterrows</span><span class="ss">()</span>:
    <span class="nv">print</span><span class="ss">(</span><span class="nv">index</span><span class="ss">)</span>
    <span class="nv">try</span>:
        <span class="nv">request</span> <span class="o">=</span> <span class="nv">requests</span>.<span class="nv">get</span><span class="ss">(</span><span class="nv">BASE_URL</span>.<span class="nv">format</span><span class="ss">(</span><span class="nv">index</span><span class="ss">))</span>
        <span class="nv">table_pass</span> <span class="o">=</span> <span class="nv">BeautifulSoup</span><span class="ss">(</span><span class="nv">request</span>.<span class="nv">text</span>, <span class="s1">&#39;</span><span class="s">lxml</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">div</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">col column-one gamepackage-away-wrap</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">pass_</span> <span class="o">=</span> <span class="nv">table_pass</span>[<span class="mi">0</span>]
        <span class="nv">player_pass_all</span> <span class="o">=</span> <span class="nv">pass_</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">tr</span><span class="s1">&#39;</span><span class="ss">)</span>


        <span class="k">for</span> <span class="nv">tr</span> <span class="nv">in</span> <span class="nv">player_pass_all</span>:
            <span class="k">for</span> <span class="nv">td</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">sacks</span><span class="s1">&#39;</span><span class="ss">)</span>:
                <span class="k">for</span> <span class="nv">t</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">name</span><span class="s1">&#39;</span><span class="ss">)</span>:
                    <span class="k">if</span> <span class="nv">t</span>.<span class="nv">text</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="s">TEAM</span><span class="s1">&#39;</span>:
                        <span class="nv">player_pass_sacks</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">int</span><span class="ss">(</span><span class="nv">td</span>.<span class="nv">text</span>[<span class="mi">0</span>:<span class="nv">td</span>.<span class="nv">text</span>.<span class="nv">index</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">-</span><span class="s1">&#39;</span><span class="ss">)</span>]<span class="ss">))</span>
                        <span class="nv">player_pass_sacks_yds_lost</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">int</span><span class="ss">(</span><span class="nv">td</span>.<span class="nv">text</span>[<span class="nv">td</span>.<span class="nv">text</span>.<span class="nv">index</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">-</span><span class="s1">&#39;</span><span class="ss">)</span><span class="o">+</span><span class="mi">1</span>:]<span class="ss">))</span>
            <span class="k">for</span> <span class="nv">td</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">c-att</span><span class="s1">&#39;</span><span class="ss">)</span>:
                <span class="k">for</span> <span class="nv">t</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">name</span><span class="s1">&#39;</span><span class="ss">)</span>:
                    <span class="k">if</span> <span class="nv">t</span>.<span class="nv">text</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="s">TEAM</span><span class="s1">&#39;</span>:
                        <span class="nv">player_pass_catch</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">int</span><span class="ss">(</span><span class="nv">td</span>.<span class="nv">text</span>[<span class="mi">0</span>:<span class="nv">td</span>.<span class="nv">text</span>.<span class="nv">index</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">/</span><span class="s1">&#39;</span><span class="ss">)</span>]<span class="ss">))</span>
                        <span class="nv">player_pass_attempt</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">int</span><span class="ss">(</span><span class="nv">td</span>.<span class="nv">text</span>[<span class="nv">td</span>.<span class="nv">text</span>.<span class="nv">index</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">/</span><span class="s1">&#39;</span><span class="ss">)</span><span class="o">+</span><span class="mi">1</span>:]<span class="ss">))</span>
            <span class="k">for</span> <span class="nv">td</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">name</span><span class="s1">&#39;</span><span class="ss">)</span>:
                <span class="k">for</span> <span class="nv">t</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">name</span><span class="s1">&#39;</span><span class="ss">)</span>:
                    <span class="k">for</span> <span class="nv">s</span> <span class="nv">in</span> <span class="nv">t</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">span</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="ss">)</span>:
                        <span class="k">if</span> <span class="nv">t</span>.<span class="nv">text</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="s">TEAM</span><span class="s1">&#39;</span>:
                            <span class="nv">player_pass_name</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">s</span>.<span class="nv">text</span><span class="ss">)</span>
            <span class="k">for</span> <span class="nv">td</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">yds</span><span class="s1">&#39;</span><span class="ss">)</span>:
                <span class="k">for</span> <span class="nv">t</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">name</span><span class="s1">&#39;</span><span class="ss">)</span>:
                    <span class="k">if</span> <span class="nv">t</span>.<span class="nv">text</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="s">TEAM</span><span class="s1">&#39;</span>:
                        <span class="nv">player_pass_yds</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">int</span><span class="ss">(</span><span class="nv">td</span>.<span class="nv">text</span><span class="ss">))</span>
            <span class="k">for</span> <span class="nv">td</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">avg</span><span class="s1">&#39;</span><span class="ss">)</span>:
                <span class="k">for</span> <span class="nv">t</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">name</span><span class="s1">&#39;</span><span class="ss">)</span>:
                    <span class="k">if</span> <span class="nv">t</span>.<span class="nv">text</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="s">TEAM</span><span class="s1">&#39;</span>:
                        <span class="nv">player_pass_avg</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">float</span><span class="ss">(</span><span class="nv">td</span>.<span class="nv">text</span><span class="ss">))</span>
            <span class="k">for</span> <span class="nv">td</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span><span class="ss">)</span>:
                <span class="k">for</span> <span class="nv">t</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">name</span><span class="s1">&#39;</span><span class="ss">)</span>:
                    <span class="k">if</span> <span class="nv">t</span>.<span class="nv">text</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="s">TEAM</span><span class="s1">&#39;</span>:
                        <span class="nv">player_pass_td</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">int</span><span class="ss">(</span><span class="nv">td</span>.<span class="nv">text</span><span class="ss">))</span>
            <span class="k">for</span> <span class="nv">td</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">int</span><span class="s1">&#39;</span><span class="ss">)</span>:
                <span class="k">for</span> <span class="nv">t</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">name</span><span class="s1">&#39;</span><span class="ss">)</span>:
                    <span class="k">if</span> <span class="nv">t</span>.<span class="nv">text</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="s">TEAM</span><span class="s1">&#39;</span>:
                        <span class="nv">player_pass_int</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">int</span><span class="ss">(</span><span class="nv">td</span>.<span class="nv">text</span><span class="ss">))</span>
            <span class="k">for</span> <span class="nv">td</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">rtg</span><span class="s1">&#39;</span><span class="ss">)</span>:
                <span class="k">for</span> <span class="nv">t</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">td</span><span class="s1">&#39;</span>, <span class="nv">class_</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">name</span><span class="s1">&#39;</span><span class="ss">)</span>:
                    <span class="k">if</span> <span class="nv">t</span>.<span class="nv">text</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="s">TEAM</span><span class="s1">&#39;</span>:
                        <span class="nv">player_pass_rtg</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">float</span><span class="ss">(</span><span class="nv">td</span>.<span class="nv">text</span><span class="ss">))</span>
                        <span class="nv">player_match_id</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">index</span><span class="ss">)</span>
            #<span class="nv">The</span> <span class="nv">code</span> <span class="nv">below</span> <span class="nv">cycles</span> <span class="nv">through</span> <span class="nv">the</span> <span class="nv">passers</span> <span class="nv">and</span> <span class="nv">gets</span> <span class="nv">their</span> <span class="nv">ESPN</span> <span class="nv">Player</span> <span class="nv">ID</span>
            <span class="k">for</span> <span class="nv">a</span> <span class="nv">in</span> <span class="nv">tr</span>.<span class="nv">find_all</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">a</span><span class="s1">&#39;</span>, <span class="nv">href</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>:
                <span class="nv">player_id</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">a</span>[<span class="s1">&#39;</span><span class="s">href</span><span class="s1">&#39;</span>].<span class="nv">replace</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">http://www.espn.com/nfl/player/_/id/</span><span class="s2">&quot;</span>,<span class="s2">&quot;&quot;</span><span class="ss">)</span>[<span class="mi">0</span>:<span class="nv">a</span>[<span class="s1">&#39;</span><span class="s">href</span><span class="s1">&#39;</span>].<span class="nv">replace</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">http://www.espn.com/nfl/player/_/id/</span><span class="s2">&quot;</span>,<span class="s2">&quot;&quot;</span><span class="ss">)</span>.<span class="nv">index</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">/</span><span class="s1">&#39;</span><span class="ss">)</span>]<span class="ss">)</span>

    <span class="nv">except</span> <span class="nv">Exception</span> <span class="nv">as</span> <span class="nv">e</span>:
        <span class="nv">pass</span>
</code></pre></div>

<p>With all of the data from above we now populate our <code>DataFrame</code> using specific headers (that's why we set the <code>headers_pass</code> variable above):</p>
<div class="highlight"><pre><span></span><code>player_passer_data = pd.DataFrame(np.column_stack((
player_match_id,
player_id,
player_pass_name,
player_pass_catch,
player_pass_attempt,
player_pass_yds,
player_pass_avg,
player_pass_td,
player_pass_int,
player_pass_sacks,
player_pass_sacks_yds_lost,
player_pass_rtg
)), columns=headers_pass)
</code></pre></div>

<p>An issue that I ran into as I was playing with the generated <code>DataFrame</code> was that even though I had set the numbers generated in the <code>for</code> loop above to be of type <code>int</code> anytime I would do something like a <code>sum()</code> on the <code>DataFrame</code> the numbers would be concatenated as though they were <code>strings</code> (because they were!).</p>
<p>After much <a href="https://www.google.com">Googling</a> I came across a <a href="http://stackoverflow.com/questions/15891038/pandas-change-data-type-of-columns">useful answer</a> on <a href="https://www.stackexchange.com">StackExchange</a> (where else would I find it, right?)</p>
<p>What it does is to set the data type of the columns from <code>string</code> to <code>int</code></p>
<div class="highlight"><pre><span></span><code>player_passer_data[[&#39;TD&#39;, &#39;CATCHES&#39;, &#39;ATTEMPTS&#39;, &#39;YDS&#39;, &#39;INT&#39;, &#39;SACKS&#39;, &#39;YRDLSTSACKS&#39;,&#39;AVG&#39;,&#39;RTG&#39;]] = player_passer_data[[&#39;TD&#39;, &#39;CATCHES&#39;, &#39;ATTEMPTS&#39;, &#39;YDS&#39;, &#39;INT&#39;, &#39;SACKS&#39;, &#39;YRDLSTSACKS&#39;,&#39;AVG&#39;,&#39;RTG&#39;]].apply(pd.to_numeric)
</code></pre></div>

<p>OK, so I've got a <code>DataFrame</code> with passer data, I've got a <code>DataFrame</code> with away game data, now I need to join them. As expected, <code>pandas</code> has a way to join <code>DataFrame</code> data ... with the <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.join.html">join</a> method obviously!</p>
<p>I create a new <code>DataFrame</code> called <code>game_passer_data</code> which joins <code>player_passer_data</code> with <code>games_away</code> on their common key <code>match_id</code>. I then have to use <code>set_index</code> to make sure that the index stays set to <code>match_id</code> ... If I don't then the <code>index</code> is reset to an auto-incremented integer.</p>
<div class="highlight"><pre><span></span><code>game_passer_data = player_passer_data.join(gamesaway, on=&#39;match_id&#39;).set_index(&#39;match_id&#39;)
</code></pre></div>

<p>This is great, but now <code>game_passer_data</code> has all of these extra columns. Below is the result of running <code>game_passer_data.head()</code> from the terminal:</p>
<div class="highlight"><pre><span></span><code>id          Name  CATCHES  ATTEMPTS  YDS  AVG  TD  INT  SACKS
</code></pre></div>

<p>match_id
    400874518  2577417  Dak Prescott       22        30  292  9.7   0    0      4
    400874674  2577417  Dak Prescott       23        32  245  7.7   2    0      2
    400874733  2577417  Dak Prescott       18        27  247  9.1   3    1      2
    400874599  2577417  Dak Prescott       21        27  247  9.1   3    0      0
    400874599    12482  Mark Sanchez        1         1    8  8.0   0    0      0</p>
<div class="highlight"><pre><span></span><code>           YRDLSTSACKS                        ...
</code></pre></div>

<p>match_id                                      ...
    400874518           14                        ...
    400874674           11                        ...
    400874733           14                        ...
    400874599            0                        ...
    400874599            0                        ...</p>
<div class="highlight"><pre><span></span><code>           ha_ind  match_date                  opp result          team_x
</code></pre></div>

<p>match_id
    400874518       @  2016-09-18  washington-redskins      W  Dallas Cowboys
    400874674       @  2016-10-02  san-francisco-49ers      W  Dallas Cowboys
    400874733       @  2016-10-16    green-bay-packers      W  Dallas Cowboys
    400874599       @  2016-11-06     cleveland-browns      W  Dallas Cowboys
    400874599       @  2016-11-06     cleveland-browns      W  Dallas Cowboys</p>
<div class="highlight"><pre><span></span><code>          week_id prefix_1             prefix_2               team_y
</code></pre></div>

<p>match_id
    400874518       2      wsh  washington-redskins  Washington Redskins
    400874674       4       sf  san-francisco-49ers  San Francisco 49ers
    400874733       6       gb    green-bay-packers    Green Bay Packers
    400874599       9      cle     cleveland-browns     Cleveland Browns
    400874599       9      cle     cleveland-browns     Cleveland Browns</p>
<div class="highlight"><pre><span></span><code>                                                         url
match_id
400874518  http://www.espn.com/nfl/team/_/name/wsh/washin...
400874674  http://www.espn.com/nfl/team/_/name/sf/san-fra...
400874733  http://www.espn.com/nfl/team/_/name/gb/green-b...
400874599  http://www.espn.com/nfl/team/_/name/cle/clevel...
400874599  http://www.espn.com/nfl/team/_/name/cle/clevel...
</code></pre></div>

<p>That is nice, but not exactly what I want. In order to remove the <em>extra</em> columns I use the <code>drop</code> method which takes 2 arguments:</p>
<ul>
<li>what object to drop</li>
<li>an axis which determine what types of object to drop (0 = rows, 1 = columns):</li>
</ul>
<p>Below, the object I define is a list of columns (figured that part all out on my own as the documentation didn't explicitly state I could use a list, but I figured, what's the worst that could happen?)</p>
<div class="highlight"><pre><span></span><code>game_passer_data = game_passer_data.drop([&#39;opp&#39;, &#39;prefix_1&#39;, &#39;prefix_2&#39;, &#39;url&#39;], 1)
</code></pre></div>

<p>Which gives me this:</p>
<div class="highlight"><pre><span></span><code>id          Name  CATCHES  ATTEMPTS  YDS  AVG  TD  INT  SACKS
</code></pre></div>

<p>match_id
    400874518  2577417  Dak Prescott       22        30  292  9.7   0    0      4
    400874674  2577417  Dak Prescott       23        32  245  7.7   2    0      2
    400874733  2577417  Dak Prescott       18        27  247  9.1   3    1      2
    400874599  2577417  Dak Prescott       21        27  247  9.1   3    0      0
    400874599    12482  Mark Sanchez        1         1    8  8.0   0    0      0</p>
<div class="highlight"><pre><span></span><code>           YRDLSTSACKS    RTG ha_ind  match_date result          team_x
</code></pre></div>

<p>match_id
    400874518           14  103.8      @  2016-09-18      W  Dallas Cowboys
    400874674           11  114.7      @  2016-10-02      W  Dallas Cowboys
    400874733           14  117.4      @  2016-10-16      W  Dallas Cowboys
    400874599            0  141.8      @  2016-11-06      W  Dallas Cowboys
    400874599            0  100.0      @  2016-11-06      W  Dallas Cowboys</p>
<div class="highlight"><pre><span></span><code>          week_id               team_y
match_id
400874518       2  Washington Redskins
400874674       4  San Francisco 49ers
400874733       6    Green Bay Packers
400874599       9     Cleveland Browns
400874599       9     Cleveland Browns
</code></pre></div>

<p>I finally have a <code>DataFrame</code> with the data I care about, <strong>BUT</strong> all of the column names are wonky!</p>
<p>This is easy enough to fix (and should have probably been fixed earlier with some of the objects I created only containing the necessary columns, but I can fix that later). By simply renaming the columns as below:</p>
<div class="highlight"><pre><span></span><code>game_passer_data.columns = [&#39;id&#39;, &#39;Name&#39;, &#39;Catches&#39;, &#39;Attempts&#39;, &#39;YDS&#39;, &#39;Avg&#39;, &#39;TD&#39;, &#39;INT&#39;, &#39;Sacks&#39;, &#39;Yards_Lost_Sacks&#39;, &#39;Rating&#39;, &#39;HA_Ind&#39;, &#39;game_date&#39;, &#39;Result&#39;, &#39;Team&#39;, &#39;Week&#39;, &#39;Opponent&#39;]
</code></pre></div>

<p>I now get the data I want, with column names to match!</p>
<div class="highlight"><pre><span></span><code>id          Name  Catches  Attempts  YDS  Avg  TD  INT  Sacks
</code></pre></div>

<p>match_id
    400874518  2577417  Dak Prescott       22        30  292  9.7   0    0      4
    400874674  2577417  Dak Prescott       23        32  245  7.7   2    0      2
    400874733  2577417  Dak Prescott       18        27  247  9.1   3    1      2
    400874599  2577417  Dak Prescott       21        27  247  9.1   3    0      0
    400874599    12482  Mark Sanchez        1         1    8  8.0   0    0      0</p>
<div class="highlight"><pre><span></span><code>           Yards_Lost_Sacks  Rating HA_Ind   game_date Result            Team
</code></pre></div>

<p>match_id
    400874518                14   103.8      @  2016-09-18      W  Dallas Cowboys
    400874674                11   114.7      @  2016-10-02      W  Dallas Cowboys
    400874733                14   117.4      @  2016-10-16      W  Dallas Cowboys
    400874599                 0   141.8      @  2016-11-06      W  Dallas Cowboys
    400874599                 0   100.0      @  2016-11-06      W  Dallas Cowboys</p>
<div class="highlight"><pre><span></span><code>          Week             Opponent
match_id
400874518    2  Washington Redskins
400874674    4  San Francisco 49ers
400874733    6    Green Bay Packers
400874599    9     Cleveland Browns
400874599    9     Cleveland Browns
</code></pre></div>

<p>I've posted the code for all three parts to my <a href="https://www.github.com/miloardot">GitHub Repo</a>.</p>
<p>Work that I still need to do:</p>
<ol>
<li>Add code to get the home game data</li>
<li>Add code to get data for the other position players</li>
<li>Add code to get data for the defense</li>
</ol>
<p>When I started this project on Wednesday I had only a bit of exposure to very basic aspects of <code>Python</code> and my background as a developer. I'm still a long way from considering myself proficient in <code>Python</code> but I know more now that I did 3 days ago and for that I'm pretty excited! It's also given my an ~~excuse~~ reason to write some stuff which is a nice side effect.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://simonwillison.net">Simon Wilison</a></li>
                            <li><a href="https://www.mattlayman.com">Matt Layman</a></li>
                            <li><a href="https://pybit.es">PyBites</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://twitter.com/ryancheley/">Twitter</a></li>
                            <li><a href="https://github.com/ryancheley">GitHub</a></li>
                            <li><a href="https://www.linkedin.com/in/ryan-cheley/">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>