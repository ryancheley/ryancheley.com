<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <title>My Place on the Internet - Web</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">My Place on the Internet</a></h1>
                <nav><ul>
                    <li><a href="/category/apple.html">Apple</a></li>
                    <li><a href="/category/automation.html">Automation</a></li>
                    <li><a href="/category/books.html">Books</a></li>
                    <li><a href="/category/coding.html">Coding</a></li>
                    <li><a href="/category/conferences.html">Conferences</a></li>
                    <li><a href="/category/conferenes.html">Conferenes</a></li>
                    <li><a href="/category/django.html">Django</a></li>
                    <li><a href="/category/github.html">GitHub</a></li>
                    <li><a href="/category/ios.html">iOS</a></li>
                    <li><a href="/category/macos.html">macOS</a></li>
                    <li><a href="/category/misc.html">misc</a></li>
                    <li><a href="/category/music.html">Music</a></li>
                    <li><a href="/category/musings.html">Musings</a></li>
                    <li><a href="/category/podcasts.html">Podcasts</a></li>
                    <li><a href="/category/productivity.html">Productivity</a></li>
                    <li><a href="/category/professional-development.html">Professional Development</a></li>
                    <li><a href="/category/python.html">Python</a></li>
                    <li><a href="/category/raspberry-pi.html">Raspberry Pi</a></li>
                    <li><a href="/category/server.html">Server</a></li>
                    <li><a href="/category/sports.html">Sports</a></li>
                    <li class="active"><a href="/category/web.html">Web</a></li>
                    <li><a href="/category/writing.html">Writing</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/getting-your-domain-to-point-to-digital-ocean-your-server.html">Getting your Domain to point to Digital Ocean Your Server</a></h1>
<footer class="post-info">
        <abbr class="published" title="2021-02-07T12:00:00+01:00">
                Published: Sun 07 February 2021
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/ryan.html">ryan</a>
        </address>
<p>In <a href="/category/web.html">Web</a>.</p>
<p>tags: <a href="/tag/digital-ocean.html">digital ocean</a> <a href="/tag/series.html">series</a> <a href="/tag/server.html">server</a> <a href="/tag/setup.html">setup</a> </p>
</footer><!-- /.post-info --><p>I use Hover for my domain purchases and management. Why? Because they have a clean, easy to use, not-slimy interface, and because I listed to enough Tech Podcasts that I’ve drank the Kool-Aid.</p>
<p>When I was trying to get my Hover Domain to point to my Digital Ocean server it seemed much harder to me than it needed to be. Specifically, I couldn’t find any guide on doing it! Many of the tutorials I did find were basically like, it’s all the same. We’ll show you with GoDaddy and then you can figure it out.</p>
<p>Yes, I can figure it out, but it wasn’t as easy as it could have been. That’s why I’m writing this up.</p>
<h2>Digital Ocean</h2>
<p>From Droplet screen click ‘Add a Domain’</p>
<div class="highlight"><pre><span></span><code>&lt;figure class=&quot;aligncenter&quot;&gt;
</code></pre></div>

<p><img alt="" class="wp-image-470" src="/images/uploads/2021/02/DraggedImage.png"></p>
<div class="highlight"><pre><span></span><code>&lt;/p&gt;
</code></pre></div>

<p>Add 2 ‘A’ records (one for www and one without the www)</p>
<p><img alt="" class="wp-image-469" src="/images/uploads/2021/02/DraggedImage-1.png"></p>
<p>Make note of the name servers</p>
<p><img alt="" class="wp-image-471" src="/images/uploads/2021/02/DraggedImage-2.png"></p>
<h2>Hover</h2>
<p>In your account at Hover.com change your Name Servers to Point to Digital Ocean ones from above.</p>
<p><img alt="" class="wp-image-468" src="/images/uploads/2021/02/DraggedImage-3.png"></p>
<h2>Wait</h2>
<p>DNS … does anyone <em>really</em> know how it works?^<a class="footnote" href="#fn1" id="ffn1">1</a>^ I just know that sometimes when I make a change it’s out there almost immediately for me, and sometimes it takes hours or days.</p>
<p>At this point, you’re just going to potentially need to wait. Why? Because DNS that’s why. Ugh!</p>
<h2>Setting up directory structure</h2>
<p>While we’re waiting for the DNS to propagate, now would be a good time to set up some file structures for when we push our code to the server.</p>
<p>For my code deploy I’ll be using a user called <code>burningfiddle</code>. We have to do two things here, create the user, and add them to the <code>www-data</code> user group on our Linux server.</p>
<p>We can run these commands to take care of that:</p>
<div class="highlight"><pre><span></span><code>adduser --disabled-password --gecos &quot;&quot; yoursite
</code></pre></div>

<p>The first line will add the user with no password and disable them to be able to log in until a password has been set. Since this user will NEVER log into the server, we’re done with the user creation piece!</p>
<p>Next, add the user to the proper group</p>
<div class="highlight"><pre><span></span><code>adduser yoursite www-data
</code></pre></div>

<p>Now we have a user and they’ve been added to the group we need them to be added. In creating the user, we also created a directory for them in the <code>home</code> directory called <code>yoursite</code>. You should now be able to run this command without error</p>
<div class="highlight"><pre><span></span><code>ls /home/yoursite/
</code></pre></div>

<p>If that returns an error indicating no such directory, then you may not have created the user properly.</p>
<p>Now we’re going to make a directory for our code to be run from.</p>
<div class="highlight"><pre><span></span><code>mkdir /home/yoursite/yoursite
</code></pre></div>

<p>To run our Django app we’ll be using virtualenv. We can create our virtualenv directory by running this command</p>
<div class="highlight"><pre><span></span><code>python3 -m venv /home/yoursite/venv
</code></pre></div>

<h2>Configuring Gunicorn</h2>
<p>There are two files needed for Gunicorn to run:</p>
<ul>
<li>gunicorn.socket</li>
<li>gunicorn.service  </li>
</ul>
<p>For our setup, this is what they look like:</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">gunicorn</span><span class="p">.</span><span class="n">socket</span><span class="w"></span>

<span class="o">[</span><span class="n">Unit</span><span class="o">]</span><span class="w"></span>
<span class="n">Description</span><span class="o">=</span><span class="n">gunicorn</span><span class="w"> </span><span class="n">socket</span><span class="w"></span>

<span class="o">[</span><span class="n">Socket</span><span class="o">]</span><span class="w"></span>
<span class="n">ListenStream</span><span class="o">=/</span><span class="n">run</span><span class="o">/</span><span class="n">gunicorn</span><span class="p">.</span><span class="n">sock</span><span class="w"></span>

<span class="o">[</span><span class="n">Install</span><span class="o">]</span><span class="w"></span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">sockets</span><span class="p">.</span><span class="n">target</span><span class="w"></span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">gunicorn</span><span class="p">.</span><span class="n">service</span><span class="w"></span>

<span class="o">[</span><span class="n">Unit</span><span class="o">]</span><span class="w"></span>
<span class="n">Description</span><span class="o">=</span><span class="n">gunicorn</span><span class="w"> </span><span class="n">daemon</span><span class="w"></span>
<span class="n">Requires</span><span class="o">=</span><span class="n">gunicorn</span><span class="p">.</span><span class="n">socket</span><span class="w"></span>
<span class="k">After</span><span class="o">=</span><span class="n">network</span><span class="p">.</span><span class="n">target</span><span class="w"></span>

<span class="o">[</span><span class="n">Service</span><span class="o">]</span><span class="w"></span>
<span class="k">User</span><span class="o">=</span><span class="n">yoursite</span><span class="w"></span>
<span class="n">EnvironmentFile</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">environment</span><span class="w"></span>
<span class="k">Group</span><span class="o">=</span><span class="n">www</span><span class="o">-</span><span class="k">data</span><span class="w"></span>
<span class="n">WorkingDirectory</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">yoursite</span><span class="o">/</span><span class="n">yoursite</span><span class="w"></span>
<span class="n">ExecStart</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">yoursite</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">gunicorn</span><span class="w">   </span>
<span class="w">         </span><span class="o">--</span><span class="n">access</span><span class="o">-</span><span class="n">logfile</span><span class="w"> </span><span class="o">-</span><span class="w">   </span>
<span class="w">         </span><span class="o">--</span><span class="n">workers</span><span class="w"> </span><span class="mi">3</span><span class="w">   </span>
<span class="w">         </span><span class="o">--</span><span class="n">bind</span><span class="w"> </span><span class="nl">unix</span><span class="p">:</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">gunicorn</span><span class="p">.</span><span class="n">sock</span><span class="w">   </span>
<span class="w">         </span><span class="n">yoursite</span><span class="p">.</span><span class="nl">wsgi</span><span class="p">:</span><span class="n">application</span><span class="w"></span>


<span class="o">[</span><span class="n">Install</span><span class="o">]</span><span class="w"></span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">multi</span><span class="o">-</span><span class="k">user</span><span class="p">.</span><span class="n">target</span><span class="w"></span>
</code></pre></div>

<p>For more on the details of the sections in both <code>gunicorn.service</code> and <code>gunicorn.socket</code> see this <a href="https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files" title="Understanding systemd units and unit files">article</a>.</p>
<h2>Environment Variables</h2>
<p>The only environment variables we have to worry about here (since we’re using SQLite) are the DJANGO_SECRET_KEY and DJANGO_DEBUG</p>
<p>We’ll want to edit <code>/etc/environment</code> with our favorite editor (I’m partial to <code>vim</code> but use whatever you like</p>
<div class="highlight"><pre><span></span><code>vim /etc/environment
</code></pre></div>

<p>In this file you’ll add your DJANGO_SECRET_KEY and DJANGO_DEBUG. The file will look something like this once you’re done:</p>
<div class="highlight"><pre><span></span><code>PATH=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games&quot;
DJANGO_SECRET_KEY=my_super_secret_key_goes_here
DJANGO_DEBUG=False
</code></pre></div>

<h2>Setting up Nginx</h2>
<p>Now we need to create our <code>.conf</code> file for Nginx. The file needs to be placed in <code>/etc/nginx/sites-available/$sitename</code> where <code>$sitename</code> is the name of your site. <a href="#" title="In my case I'm leaving off the tld but you could just as easily name it with the tld">fn</a></p>
<p>The final file will look (something) like this <a href="#" title="Note that my site is called yoursite in this example">fn</a></p>
<div class="highlight"><pre><span></span><code><span class="nt">server</span> <span class="p">{</span>
    <span class="err">listen</span> <span class="err">80</span><span class="p">;</span>
    <span class="err">server_name</span> <span class="err">www.yoursite.com</span> <span class="err">yoursite.com</span><span class="p">;</span>

    <span class="err">location</span> <span class="err">=</span> <span class="err">/favicon.ico</span> <span class="err">{</span> <span class="err">access_log</span> <span class="err">off</span><span class="p">;</span> <span class="err">log_not_found</span> <span class="err">off</span><span class="p">;</span> <span class="p">}</span>
    <span class="nt">location</span> <span class="o">/</span><span class="nt">static</span><span class="o">/</span> <span class="p">{</span>
        <span class="err">root</span> <span class="err">/home/yoursite/yoursite/</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nt">location</span> <span class="o">/</span> <span class="p">{</span>
        <span class="err">include</span> <span class="err">proxy_params</span><span class="p">;</span>
        <span class="err">proxy_pass</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">unix</span><span class="o">:/</span><span class="n">run</span><span class="o">/</span><span class="n">gunicorn</span><span class="o">.</span><span class="n">sock</span><span class="p">;</span>
    <span class="p">}</span>
<span class="err">}</span>
</code></pre></div>

<p>The <code>.conf</code> file above tells Nginx to listen for requests to either <code>www.buringfiddle.com</code> or <code>buringfiddle.com</code> and then route them to the location <code>/home/yoursite/yoursite/</code> which is where our files are located for our Django project.</p>
<p>With that in place all that’s left to do is to make it enabled by running replacing <code>$sitename</code> with your file</p>
<div class="highlight"><pre><span></span><code>ln -s /etc/nginx/sites-available/$sitename /etc/nginx/sites-enabled
</code></pre></div>

<p>You’ll want to run</p>
<div class="highlight"><pre><span></span><code>nginx -t
</code></pre></div>

<p>to make sure there aren’t any errors. If no errors occur you’ll need to restart Nginx</p>
<div class="highlight"><pre><span></span><code>systemctl restart nginx
</code></pre></div>

<p>The last thing to do is to allow full access to Nginx. You do this by running</p>
<div class="highlight"><pre><span></span><code>ufw allow &#39;Nginx Full&#39;
</code></pre></div>

<ol>
<li>[Probably just <a href="https://jvns.ca/blog/how-updating-dns-works/">Julia Evans</a> <a href="#ffn1">↩</a>]{#fn1}</li>
</ol>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://simonwillison.net">Simon Wilison</a></li>
                            <li><a href="https://www.mattlayman.com">Matt Layman</a></li>
                            <li><a href="https://pybit.es">PyBites</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://twitter.com/ryancheley/">Twitter</a></li>
                            <li><a href="https://github.com/ryancheley">GitHub</a></li>
                            <li><a href="https://www.linkedin.com/in/ryan-cheley/">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>