<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>My Place on the Internet - Raspberry Pi</title><link href="https://www.ryancheley.com/" rel="alternate"></link><link href="https://www.ryancheley.com/feeds/raspberry-pi.atom.xml" rel="self"></link><id>https://www.ryancheley.com/</id><updated>2019-06-23T14:43:00+02:00</updated><entry><title>Taking Down the RPi Camera Over My Hummingbird Feeder</title><link href="https://www.ryancheley.com/taking-down-the-rpi-camera-over-my-hummingbird-feeder.html" rel="alternate"></link><published>2019-06-23T14:43:00+02:00</published><updated>2019-06-23T14:43:00+02:00</updated><author><name>ryan</name></author><id>tag:www.ryancheley.com,2019-06-23:/taking-down-the-rpi-camera-over-my-hummingbird-feeder.html</id><summary type="html">&lt;p&gt;As the temperature heats up it’s time to take down my hummingbird feeder. While the winds have cooled down the valley for the last few days, 100+ days are slowly creeping in and I need to take it down before the CPU melts.&lt;/p&gt;
&lt;p&gt;When I took it down last …&lt;/p&gt;</summary><content type="html">&lt;p&gt;As the temperature heats up it’s time to take down my hummingbird feeder. While the winds have cooled down the valley for the last few days, 100+ days are slowly creeping in and I need to take it down before the CPU melts.&lt;/p&gt;
&lt;p&gt;When I took it down last year I though, meh, how hard could it be to put back up. And then I put it back up in the Fall last year and had nothing but problems.&lt;/p&gt;
&lt;p&gt;This year, I wanted to document the wires and what not so that I can just put it back up once the temps cool down outside.&lt;/p&gt;
&lt;p&gt;Anyway, I could describe it or just take some pictures ... so here are some pictures for when I need to set it up again later this year.&lt;/p&gt;
&lt;p&gt;Above the feeder:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" class="alignnone size-full wp-image-359" height="3024" src="/images/uploads/2019/06/Image-6-23-19-3-39-PM.png" width="4032"&gt;&lt;/p&gt;
&lt;p&gt;Wires to the sensor:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" class="alignnone size-full wp-image-357" height="3024" src="/images/uploads/2019/06/Image-6-22-19-11-03-AM.png" width="4032"&gt;&lt;/p&gt;
&lt;p&gt;Wires to the GPIO pins:&lt;/p&gt;
&lt;p&gt;&lt;img alt="" class="alignnone size-full wp-image-358" height="3024" src="/images/uploads/2019/06/Image-6-22-19-11-03-AM-1.png" width="4032"&gt;&lt;/p&gt;</content><category term="Raspberry Pi"></category><category term="Hummingbird"></category><category term="setup"></category></entry><entry><title>Making it easy to ssh into a remote server: Addendum</title><link href="https://www.ryancheley.com/making-it-easy-to-ssh-into-a-remote-server-addendum.html" rel="alternate"></link><published>2019-03-25T18:30:00+01:00</published><updated>2019-03-25T18:30:00+01:00</updated><author><name>ryan</name></author><id>tag:www.ryancheley.com,2019-03-25:/making-it-easy-to-ssh-into-a-remote-server-addendum.html</id><summary type="html">&lt;p&gt;I recently got a new raspberry pi (yes, I might have a problem) and wanted to be able to ssh into it without having to remember the IP or password. Luckily I wrote &lt;a href="/making-it-easy-to-ssh-into-a-remote-server.html"&gt;this helpful post&lt;/a&gt; several months ago.&lt;/p&gt;
&lt;p&gt;While it go me most of the way there, I did …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I recently got a new raspberry pi (yes, I might have a problem) and wanted to be able to ssh into it without having to remember the IP or password. Luckily I wrote &lt;a href="/making-it-easy-to-ssh-into-a-remote-server.html"&gt;this helpful post&lt;/a&gt; several months ago.&lt;/p&gt;
&lt;p&gt;While it go me most of the way there, I did run into a slight issue.&lt;/p&gt;
&lt;h2&gt;First Issue&lt;/h2&gt;
&lt;p&gt;The issue was that I had a typo for the command to generate a key. I had:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ssh-keyken -t rsa&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Which should have been:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ssh-keygen -t rsa&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;When I copied and pasted the original command the terminal said there was no such command. 🤦‍♂️&lt;/p&gt;
&lt;h2&gt;Second Issue&lt;/h2&gt;
&lt;p&gt;Once that go cleared up I went through the steps and was able to get everything set up. Or so I thought. On attempting to ssh into my new pi I was greeted with a password prompt. WTF?&lt;/p&gt;
&lt;p&gt;The first thing I did was to check to see what keys were in my \~/.ssh folder. Sure enough there were a couple of them in there.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ls ~/.ssh
id_rsa             id_rsa.github      id_rsa.github.pub  id_rsa.pub         known_hosts        read_only_key      read_only_key.pub
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Next, I interrogated the help command for &lt;code&gt;ssh-copy-id&lt;/code&gt; to see what flags were available.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;Usage&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;-h|-?|-f|-n&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;-i [identity_file&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;-p port&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;[-o &amp;lt;ssh -o options&amp;gt;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;&lt;span class="err"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;user@&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="n"&gt;hostname&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;force&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;without&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;trying&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;check&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;they&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;already&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;installed&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;n&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dry&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;no&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actually&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;copied&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;|-&lt;/span&gt;&lt;span class="vm"&gt;?&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;help&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I figured let’s try the &lt;code&gt;-n&lt;/code&gt; flag and get the output from that. Doing so gave me&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ryan&lt;/span&gt;&lt;span class="nv"&gt;@Ryans&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;MBP&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="n"&gt;Desktop&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;pi&lt;/span&gt;&lt;span class="nv"&gt;@newpi&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;INFO&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Source&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;of&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;key&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;be&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;installed&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;/Users/ryan/.ssh/id_rsa.github.pub&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;INFO&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;attempting&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;log&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;key&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;out&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;any&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;that&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;are&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;already&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;installed&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nl"&gt;id&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nl"&gt;WARNING&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;All&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;were&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;skipped&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;because&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;they&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;already&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exist&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;on&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;the&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;remote&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;system&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;think&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;this&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;is&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mistake&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;you&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;may&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;want&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;use&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;option&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;OK … why is it sending the GitHub key? That’s a different problem for a different time. I see another flag available is the &lt;code&gt;-i&lt;/code&gt; which will allow me to specify which key I want to send. Aha!&lt;/p&gt;
&lt;p&gt;OK, now all that I need to do is use the following command to test the output:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;id_rsa&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;pi&lt;/span&gt;&lt;span class="nv"&gt;@newpi&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And sure enough it’s sending the correct key&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;id&lt;/span&gt;: &lt;span class="nv"&gt;INFO&lt;/span&gt;: &lt;span class="nv"&gt;Source&lt;/span&gt; &lt;span class="nv"&gt;of&lt;/span&gt; &lt;span class="nv"&gt;key&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;s&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;be&lt;/span&gt; &lt;span class="nv"&gt;installed&lt;/span&gt;: &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;/Users/ryan/.ssh/id_rsa.pub&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;id&lt;/span&gt;: &lt;span class="nv"&gt;INFO&lt;/span&gt;: &lt;span class="nv"&gt;attempting&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;log&lt;/span&gt; &lt;span class="nv"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;with&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;new&lt;/span&gt; &lt;span class="nv"&gt;key&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;s&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;, &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;filter&lt;/span&gt; &lt;span class="nv"&gt;out&lt;/span&gt; &lt;span class="nv"&gt;any&lt;/span&gt; &lt;span class="nv"&gt;that&lt;/span&gt; &lt;span class="nv"&gt;are&lt;/span&gt; &lt;span class="nv"&gt;already&lt;/span&gt; &lt;span class="nv"&gt;installed&lt;/span&gt;

&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;id&lt;/span&gt;: &lt;span class="nv"&gt;WARNING&lt;/span&gt;: &lt;span class="nv"&gt;All&lt;/span&gt; &lt;span class="nv"&gt;keys&lt;/span&gt; &lt;span class="nv"&gt;were&lt;/span&gt; &lt;span class="nv"&gt;skipped&lt;/span&gt; &lt;span class="nv"&gt;because&lt;/span&gt; &lt;span class="nv"&gt;they&lt;/span&gt; &lt;span class="nv"&gt;already&lt;/span&gt; &lt;span class="nv"&gt;exist&lt;/span&gt; &lt;span class="nv"&gt;on&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;remote&lt;/span&gt; &lt;span class="nv"&gt;system&lt;/span&gt;.
        &lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;you&lt;/span&gt; &lt;span class="nv"&gt;think&lt;/span&gt; &lt;span class="nv"&gt;this&lt;/span&gt; &lt;span class="nv"&gt;is&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="nv"&gt;mistake&lt;/span&gt;, &lt;span class="nv"&gt;you&lt;/span&gt; &lt;span class="nv"&gt;may&lt;/span&gt; &lt;span class="nv"&gt;want&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;use&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;f&lt;/span&gt; &lt;span class="nv"&gt;option&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Remove the &lt;code&gt;-n&lt;/code&gt; flag to send it for real&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;id_rsa&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pub&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;pi&lt;/span&gt;&lt;span class="nv"&gt;@newpi&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And try to ssh in again&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;pi&lt;/span&gt;&lt;span class="nv"&gt;@newpi&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Success!&lt;/p&gt;
&lt;p&gt;I wanted to write this up for 2 reasons:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;So I can refer back to it if I ever need to. This blog is mostly for me to write down technical things that I do so I can remember them later on&lt;/li&gt;
&lt;li&gt;This is the first time I’ve run into an issue with a command like tool and simply used the help to figure out how to fix the problem and I wanted to memorialize that. It felt &lt;a href="https://thegoodplace.fandom.com/wiki/Censored_Curse_Words"&gt;forking&lt;/a&gt; awesome to do that.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Footnote: Yes … calling my new raspberry pi &lt;code&gt;newpi&lt;/code&gt; in my hosts file is dumb. Yes, when I get my next new Raspberry Pi I will be wondering what to call it. YEs, I am going to try and remember to make the change before it happens so that I don’t end up with the next Pi being called &lt;code&gt;newnewpi&lt;/code&gt; and the one after that being &lt;code&gt;newnewnewpi&lt;/code&gt;&lt;/p&gt;</content><category term="Raspberry Pi"></category><category term="SSH"></category></entry><entry><title>Monitoring the temperature of my Raspberry Pi Camera</title><link href="https://www.ryancheley.com/monitoring-the-temperature-of-my-raspberry-pi-camera.html" rel="alternate"></link><published>2018-12-04T07:07:00+01:00</published><updated>2018-12-04T07:07:00+01:00</updated><author><name>ryan</name></author><id>tag:www.ryancheley.com,2018-12-04:/monitoring-the-temperature-of-my-raspberry-pi-camera.html</id><summary type="html">&lt;p&gt;In late April of this year I wrote a script that would capture the temperature of the Raspberry Pi that sits above my Hummingbird feeder and log it to a file.&lt;/p&gt;
&lt;p&gt;It’s a straight forward enough script that captures the date, time and temperature as given by the internal …&lt;/p&gt;</summary><content type="html">&lt;p&gt;In late April of this year I wrote a script that would capture the temperature of the Raspberry Pi that sits above my Hummingbird feeder and log it to a file.&lt;/p&gt;
&lt;p&gt;It’s a straight forward enough script that captures the date, time and temperature as given by the internal &lt;code&gt;measure_temp&lt;/code&gt; function. In code it looks like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;MyDate=&amp;quot;`date +&amp;#39;%m/%d/%Y, %H:%M, &amp;#39;`&amp;quot;
MyTemp=&amp;quot;`/opt/vc/bin/vcgencmd measure_temp |tr -d &amp;quot;=temp&amp;#39;C&amp;quot;`&amp;quot;
echo &amp;quot;$MyDate$MyTemp&amp;quot; &amp;gt;&amp;gt; /home/pi/Documents/python_projects/temperature/temp.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I haven’t ever really done anything with the file, but one thing I wanted to do was to get alerted if (when) the temperature exceeded the recommended level of 70 C.&lt;/p&gt;
&lt;p&gt;To do this I installed &lt;code&gt;ssmtp&lt;/code&gt; onto my Pi using &lt;code&gt;apt-get&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt-get install ssmtp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With that installed I am able to send an email using the following command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;This is the email body&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;This is the subject&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="nv"&gt;@domain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tld&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;With this tool in place I was able to attempt to send an alert if (when) the Pi’s temperature got above 70 C (the maximum recommended running temp).&lt;/p&gt;
&lt;p&gt;At first, I tried adding this code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt; &amp;quot;$MyTemp&amp;quot; -gt &amp;quot;70&amp;quot; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;Camera Pi Running Hot&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;Warning! The Camera Pi is Running Hot!!!&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="nv"&gt;@domain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tld&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;fi&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Where the &lt;code&gt;$MyTemp&lt;/code&gt; came from the above code that get’s logged to the temp.log file.&lt;/p&gt;
&lt;p&gt;It didn’t work. The problem is that the temperature I’m capturing for logging purposes is a float, while the item it was being compared to was an integer. No problem, I’ll just make the “70” into a “70.0” and that will fix the ... oh wait. That didn’t work either.&lt;/p&gt;
&lt;p&gt;OK. I tried various combinations, trying to see what would work and finally determined that there is a way to get the temperature as an integer, but it meant using a different method to capture it. This is done by adding this line:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ComparisonTemp=$(($(cat /sys/class/thermal/thermal_zone0/temp)/1000))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The code above gets the temperature as an integer. I then use that in my &lt;code&gt;if&lt;/code&gt; statement for checking the temperature:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt; &amp;quot;$ComparisonTemp&amp;quot; -gt &amp;quot;70&amp;quot; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;Camera Pi Running Hot&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;Warning! The Camera Pi is Running Hot!!!&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="nv"&gt;@domain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tld&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;fi&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Giving a final script that looks like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;MyDate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;`date +&amp;#39;%m/%d/%Y, %H:%M, &amp;#39;`&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;MyTemp&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;`/opt/vc/bin/vcgencmd measure_temp |tr -d &amp;quot;&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;temp&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;`&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;$MyDate$MyTemp&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nf"&gt;pi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Documents&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;python_projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;temperature&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;temp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;log&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;ComparisonTemp&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;thermal&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;thermal_zone0&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;temp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt; &amp;quot;$ComparisonTemp&amp;quot; -gt &amp;quot;70&amp;quot; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;Camera Pi Running Hot&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mail&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;Warning! The Camera Pi is Running Hot!!!&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;user&lt;/span&gt;&lt;span class="nv"&gt;@domain&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tld&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="n"&gt;fi&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Raspberry Pi"></category><category term="automation"></category><category term="Bash"></category><category term="Raspberry Pi"></category></entry><entry><title>The PIR Sensor Debacle of 2018</title><link href="https://www.ryancheley.com/the-pir-sensor.html" rel="alternate"></link><published>2018-11-10T11:26:00+01:00</published><updated>2018-11-10T11:26:00+01:00</updated><author><name>ryan</name></author><id>tag:www.ryancheley.com,2018-11-10:/the-pir-sensor.html</id><summary type="html">&lt;p&gt;Last spring I set up a Raspberry Pi to record humming birds at my hummingbird feeder, compile the recorded h264 files into an mp4 and upload it to YouTube.&lt;/p&gt;
&lt;p&gt;I’ve written about that process before here, here, and here.&lt;/p&gt;
&lt;p&gt;This post is a bit of documentation to remind myself …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Last spring I set up a Raspberry Pi to record humming birds at my hummingbird feeder, compile the recorded h264 files into an mp4 and upload it to YouTube.&lt;/p&gt;
&lt;p&gt;I’ve written about that process before here, here, and here.&lt;/p&gt;
&lt;p&gt;This post is a bit of documentation to remind myself about how to connect the PIR sensor to the Raspberry Pi so I don’t forget.&lt;/p&gt;
&lt;p&gt;When I went to set it up this year, it appeared like the PIR sensor wasn’t working. It would start the video capture, but it wouldn’t end it.&lt;/p&gt;
&lt;p&gt;I tried a couple of different things (including the purchase of some new PIR sensors) but none of them seemed to work. I was worried that the heat from the early bit of summer last year had maybe fried my little Pi.&lt;/p&gt;
&lt;p&gt;But no, it turns out that the link I was using as the basis for my project had a diagram AND a description about how to connect the PIR.&lt;/p&gt;
&lt;p&gt;I had assumed that the diagram was correct and that I didn’t need to read the description, but it turns out I did BECAUSE the diagram had the connections set up in a way that didn’t line up with the PIR sensor(s) I have.&lt;/p&gt;
&lt;p&gt;&lt;img alt="" class="alignnone size-full wp-image-313" height="375" src="/images/uploads/2018/11/pir-diagram-1.png" width="1000"&gt;&lt;/p&gt;
&lt;p&gt;In the Parent Detector PIR sensor the connectors are (1) Power, (2) Ground, (3) Out&lt;/p&gt;
&lt;p&gt;&lt;img alt="" class="alignnone size-full wp-image-314" height="4032" src="/images/uploads/2018/11/IMG_0282.jpg" width="3024"&gt;&lt;/p&gt;
&lt;p&gt;In my PIR sensor the connectors are (1) Power, (2) Out, (3) Ground.&lt;/p&gt;
&lt;p&gt;This meant that the power was getting to the PIR sensor, but there was no way to send the trip because the signal was being sent to the Ground.&lt;/p&gt;
&lt;p&gt;Anyway, the morale of the story is, pictures are nice, but reading may save you some time (and money) in the long run.&lt;/p&gt;</content><category term="Raspberry Pi"></category><category term="Hummingbird"></category><category term="pir sensor"></category></entry><entry><title>Making it easy to ssh into a remote server</title><link href="https://www.ryancheley.com/making-it-easy-to-ssh-into-a-remote-server.html" rel="alternate"></link><published>2018-05-05T12:54:00+02:00</published><updated>2018-05-05T12:54:00+02:00</updated><author><name>ryan</name></author><id>tag:www.ryancheley.com,2018-05-05:/making-it-easy-to-ssh-into-a-remote-server.html</id><summary type="html">&lt;p&gt;Logging into a remote server is a drag. Needing to remember the password (or get it from &lt;a href="https://1password.com"&gt;1Password&lt;/a&gt;); needing to remember the IP address of the remote server. Ugh.&lt;/p&gt;
&lt;p&gt;It’d be so much easier if I could just&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="nv"&gt;@servername&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;and get into the server.&lt;/p&gt;
&lt;p&gt;And it turns …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Logging into a remote server is a drag. Needing to remember the password (or get it from &lt;a href="https://1password.com"&gt;1Password&lt;/a&gt;); needing to remember the IP address of the remote server. Ugh.&lt;/p&gt;
&lt;p&gt;It’d be so much easier if I could just&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;username&lt;/span&gt;&lt;span class="nv"&gt;@servername&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;and get into the server.&lt;/p&gt;
&lt;p&gt;And it turns out, you can. You just need to do two simple things.&lt;/p&gt;
&lt;h2&gt;Simple thing the first: Update the &lt;code&gt;hosts&lt;/code&gt; file on your local computer to map the IP address to a memorable name.&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;hosts&lt;/code&gt; file is located at &lt;code&gt;/etc/hosts&lt;/code&gt; (at least on *nix based systems).&lt;/p&gt;
&lt;p&gt;Go to the hosts file in your favorite editor … my current favorite editor for simple stuff like this is vim.&lt;/p&gt;
&lt;p&gt;Once there, add the IP address you don’t want to have to remember, and then a name that you will remember. For example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="mf"&gt;67.176.220.115&lt;/span&gt;    &lt;span class="n"&gt;easytoremembername&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;One thing to keep in mind, you’ll already have some entries in this file. Don’t mess with them. Leave them there. Seriously … it’ll be better for everyone if you do.&lt;/p&gt;
&lt;h2&gt;Simple thing the second: Generate a public-private key and share the public key with the remote server&lt;/h2&gt;
&lt;p&gt;From the terminal run the command &lt;code&gt;ssh-keygen -t rsa&lt;/code&gt;. This will generate a public and private key. You will be asked for a location to save the keys to. The default (on MacOS) is &lt;code&gt;/Users/username/.ssh/id_rsa&lt;/code&gt;. I tend to accept the default (no reason not to) and leave the passphrase blank (this means you won’t have to enter a password which is what we’re looking for in the first place!)&lt;/p&gt;
&lt;p&gt;Next, we copy the public key to the host(s) you want to access using the command&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ssh-copy-id &amp;lt;username&amp;gt;@&amp;lt;hostname&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;for example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;ssh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;pi&lt;/span&gt;&lt;span class="nv"&gt;@rpicamera&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The first time you do this you will get a message asking you if you’re sure you want to do this. Type in &lt;code&gt;yes&lt;/code&gt; and you’re good to go.&lt;/p&gt;
&lt;p&gt;One thing to note, doing this updates the file &lt;code&gt;known_hosts&lt;/code&gt;. If, for some reason, the server you are ssh-ing to needs to be rebuilt (i.e. you have to keep destroying your Digital Ocean Ubuntu server because you can’t get the static files to be served properly for your Django project) then you need to go to the &lt;code&gt;known_hosts&lt;/code&gt; file and remove the entry for that known host.&lt;/p&gt;
&lt;p&gt;When you do that you’ll be asked about the identity of the server (again). Just say yes and you’re good to go.&lt;/p&gt;
&lt;p&gt;If you forget that step then when you try to ssh into the server you get a nasty looking error message saying that the server identities don’t match and you can’t proceed.&lt;/p&gt;</content><category term="Raspberry Pi"></category><category term="digital ocean"></category><category term="linux"></category><category term="Remote servers"></category><category term="SSH"></category><category term="Terminal"></category></entry><entry><title>Automating the Hummingbird Video Upload to YouTube or How I finally got Cron to do what I needed it to do but in the ugliest way possible</title><link href="https://www.ryancheley.com/automating-the-hummingbird-video-upload-to-youtube-or-how-i-finally-got-cron-to-do-what-i-needed-it-to-do-but-in-the-ugliest-way-possible.html" rel="alternate"></link><published>2018-05-02T16:44:00+02:00</published><updated>2018-05-02T16:44:00+02:00</updated><author><name>ryan</name></author><id>tag:www.ryancheley.com,2018-05-02:/automating-the-hummingbird-video-upload-to-youtube-or-how-i-finally-got-cron-to-do-what-i-needed-it-to-do-but-in-the-ugliest-way-possible.html</id><summary type="html">&lt;p&gt;Several weeks ago in &lt;a href="/cronjob-redux.html"&gt;Cronjob Redux&lt;/a&gt; I wrote that I had &lt;em&gt;finally&lt;/em&gt; gotten Cron to automate the entire process of compiling the &lt;code&gt;h264&lt;/code&gt; files into an &lt;code&gt;mp4&lt;/code&gt; and uploading it to &lt;a href="https://www.youtube.com"&gt;YouTube&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I hadn’t. And it took the better part of the last 2 weeks to figure out what …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Several weeks ago in &lt;a href="/cronjob-redux.html"&gt;Cronjob Redux&lt;/a&gt; I wrote that I had &lt;em&gt;finally&lt;/em&gt; gotten Cron to automate the entire process of compiling the &lt;code&gt;h264&lt;/code&gt; files into an &lt;code&gt;mp4&lt;/code&gt; and uploading it to &lt;a href="https://www.youtube.com"&gt;YouTube&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I hadn’t. And it took the better part of the last 2 weeks to figure out what the heck was going on.&lt;/p&gt;
&lt;p&gt;Part of what I wrote before was correct. I wasn’t able to read the &lt;code&gt;client_secrets.json&lt;/code&gt; file and that was leading to an error.&lt;/p&gt;
&lt;p&gt;I was &lt;em&gt;not&lt;/em&gt; correct on the creation of the &lt;code&gt;create_mp4.sh&lt;/code&gt; though.&lt;/p&gt;
&lt;p&gt;The reason I got it to run automatically that night was because I had, in my testing, created the &lt;code&gt;create_mp4.sh&lt;/code&gt; and when cron ran my &lt;code&gt;run_script.sh&lt;/code&gt; it was able to use what was already there.&lt;/p&gt;
&lt;p&gt;The next night when it ran, the &lt;code&gt;create_mp4.sh&lt;/code&gt; was already there, but the &lt;code&gt;h264&lt;/code&gt; files that were referenced in it weren’t. This lead to no video being uploaded and me being confused.&lt;/p&gt;
&lt;p&gt;The issue was that cron was unable to run the part of the script that generates the script to create the &lt;code&gt;mp4&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;I’m close to having a fix for that, but for now I did the most inelegant thing possible. I broke up the script in cron so it looks like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="mf"&gt;00&lt;/span&gt; &lt;span class="mf"&gt;06&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Documents&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;python_projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cleanup&lt;/span&gt;&lt;span class="mf"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;span class="mf"&gt;10&lt;/span&gt; &lt;span class="mf"&gt;19&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Documents&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;python_projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;create_script_01&lt;/span&gt;&lt;span class="mf"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;span class="mf"&gt;11&lt;/span&gt; &lt;span class="mf"&gt;19&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Documents&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;python_projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;create_script_02&lt;/span&gt;&lt;span class="mf"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;HOME&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Documents&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;python_projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;create_mp4&lt;/span&gt;&lt;span class="mf"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt; &lt;span class="mf"&gt;2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="err"&gt;&amp;amp;&lt;/span&gt;&lt;span class="mf"&gt;1&lt;/span&gt;
&lt;span class="mf"&gt;12&lt;/span&gt; &lt;span class="mf"&gt;19&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Documents&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;python_projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;create_script_03&lt;/span&gt;&lt;span class="mf"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;span class="mf"&gt;13&lt;/span&gt; &lt;span class="mf"&gt;19&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Documents&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;python_projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="kr"&gt;run&lt;/span&gt;&lt;span class="n"&gt;_script&lt;/span&gt;&lt;span class="mf"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;At 6am every morning the &lt;code&gt;cleanup.sh&lt;/code&gt; runs and removes the &lt;code&gt;h264&lt;/code&gt; files, the &lt;code&gt;mp4&lt;/code&gt; file and the &lt;code&gt;create_mp4.sh&lt;/code&gt; script&lt;/p&gt;
&lt;p&gt;At 7:10pm the ‘&lt;a href="https://gist.github.com/ryancheley/5b11cc15160f332811a3b3d04edf3780"&gt;header&lt;/a&gt;’ for the &lt;code&gt;create_mp4.sh&lt;/code&gt; runs. At 7:11pm the ‘&lt;a href="https://gist.github.com/ryancheley/9e502a9f1ed94e29c4d684fa9a8c035a"&gt;body&lt;/a&gt;’ for &lt;code&gt;create_mp4.sh&lt;/code&gt; runs. At 7:12pm the ‘&lt;a href="https://gist.github.com/ryancheley/3c91a4b27094c365b121a9dc694c3486"&gt;footer&lt;/a&gt;’ for &lt;code&gt;create_mp4.sh&lt;/code&gt; runs.&lt;/p&gt;
&lt;p&gt;Finally at 7:13pm the &lt;code&gt;run_script.sh&lt;/code&gt; compiles the &lt;code&gt;h264&lt;/code&gt; files into an &lt;code&gt;mp4&lt;/code&gt; and uploads it to YouTube.&lt;/p&gt;
&lt;p&gt;Last night while I was at a School Board meeting the whole process ran on it’s own. I was super pumped when I checked my YouTube channel and saw that the May 1 hummingbird video was there and I didn’t have to do anything.&lt;/p&gt;</content><category term="Raspberry Pi"></category><category term="automation"></category><category term="Raspberry Pi"></category><category term="youtube"></category></entry><entry><title>Hummingbird Video Capture</title><link href="https://www.ryancheley.com/hummingbird-video-capture.html" rel="alternate"></link><published>2018-04-05T17:46:00+02:00</published><updated>2018-04-05T17:46:00+02:00</updated><author><name>ryan</name></author><id>tag:www.ryancheley.com,2018-04-05:/hummingbird-video-capture.html</id><summary type="html">&lt;p&gt;I &lt;a href="/using-mp4box-to-concatenate-many-h264-files-into-one-mp4-file-revisited.html"&gt;previously wrote&lt;/a&gt; about how I placed my Raspberry Pi above my hummingbird feeder and added a camera to it to capture video.&lt;/p&gt;
&lt;p&gt;Well, the day has finally come where I’ve been able to put my video of it up on &lt;a href="https://youtu.be/_oNlhrZJ-0Y"&gt;YouTube&lt;/a&gt;! It’s totally silly, but it was …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I &lt;a href="/using-mp4box-to-concatenate-many-h264-files-into-one-mp4-file-revisited.html"&gt;previously wrote&lt;/a&gt; about how I placed my Raspberry Pi above my hummingbird feeder and added a camera to it to capture video.&lt;/p&gt;
&lt;p&gt;Well, the day has finally come where I’ve been able to put my video of it up on &lt;a href="https://youtu.be/_oNlhrZJ-0Y"&gt;YouTube&lt;/a&gt;! It’s totally silly, but it was satisfying getting it out there for everyone to watch and see.&lt;/p&gt;
&lt;h2&gt;Hummingbird Video Capture: Addendum&lt;/h2&gt;
&lt;p&gt;The code used to generate the the &lt;code&gt;mp4&lt;/code&gt; file haven’t changed (really). I did do a couple of things to make it a little easier though.&lt;/p&gt;
&lt;p&gt;I have 2 scripts that generate the file and then copy it from the pi to my MacBook Pro and the clean up:&lt;/p&gt;
&lt;p&gt;Script 1 is called &lt;code&gt;create_script.sh&lt;/code&gt; and looks like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#!/bin/sh&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;MP4Box&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;h264&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;index&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;${!&lt;/span&gt;&lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;@&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt; &amp;quot;$index&amp;quot; -eq 0 &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot; -add ${array[index]}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot; -cat ${array[index]}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fi&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;done&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot; hummingbird.mp4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;create_mp4&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chmod&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;create_mp4&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This creates a script called &lt;code&gt;create_mp4.sh&lt;/code&gt; and makes it executable.&lt;/p&gt;
&lt;p&gt;This script is called by another script called &lt;code&gt;run_script.sh&lt;/code&gt; and looks like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;create_script&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;create_mp4&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;

&lt;span class="n"&gt;scp&lt;/span&gt; &lt;span class="n"&gt;hummingbird&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mp4&lt;/span&gt; &lt;span class="n"&gt;ryan&lt;/span&gt;&lt;span class="mf"&gt;@192.168.1.209&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;Users&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ryan&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Desktop&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;

&lt;span class="cp"&gt;# Next we remove the video files locally&lt;/span&gt;

&lt;span class="n"&gt;rm&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;h264&lt;/span&gt;
&lt;span class="n"&gt;rm&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mp4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;It runs the &lt;code&gt;create_script.sh&lt;/code&gt; which creates &lt;code&gt;create_mpr.sh&lt;/code&gt; and then runs it.&lt;/p&gt;
&lt;p&gt;Then I use the &lt;code&gt;scp&lt;/code&gt; command to copy the &lt;code&gt;mp4&lt;/code&gt; file that was just created over to my Mac Book Pro.&lt;/p&gt;
&lt;p&gt;As a last bit of housekeeping I clean up the video files.&lt;/p&gt;
&lt;p&gt;I’ve added this &lt;code&gt;run_script.sh&lt;/code&gt; to a cron job that is scheduled to run every night at midnight.&lt;/p&gt;
&lt;p&gt;We’ll see how well it runs tomorrow night!&lt;/p&gt;</content><category term="Raspberry Pi"></category><category term="Hummingbird"></category><category term="python"></category><category term="video"></category><category term="youtube"></category></entry><entry><title>Setting up ITFDB with a voice</title><link href="https://www.ryancheley.com/setting-up-itfdb-with-a-voice.html" rel="alternate"></link><published>2018-03-15T17:41:00+01:00</published><updated>2018-03-15T17:41:00+01:00</updated><author><name>ryan</name></author><id>tag:www.ryancheley.com,2018-03-15:/setting-up-itfdb-with-a-voice.html</id><summary type="html">&lt;p&gt;In a &lt;a href="/itfdb.html"&gt;previous post&lt;/a&gt; I wrote about my Raspberry Pi experiment to have the SenseHat display a scrolling message 10 minutes before game time.&lt;/p&gt;
&lt;p&gt;One of the things I have wanted to do since then is have Vin Scully’s voice come from a speaker and say those five magical …&lt;/p&gt;</summary><content type="html">&lt;p&gt;In a &lt;a href="/itfdb.html"&gt;previous post&lt;/a&gt; I wrote about my Raspberry Pi experiment to have the SenseHat display a scrolling message 10 minutes before game time.&lt;/p&gt;
&lt;p&gt;One of the things I have wanted to do since then is have Vin Scully’s voice come from a speaker and say those five magical words, &lt;code&gt;It's time for Dodger Baseball!&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I found a clip of &lt;a href="https://www.youtube.com/watch?v=4KwFuGtGU6c"&gt;Vin on Youtube&lt;/a&gt; saying that (and a little more). I wasn’t sure how to get the audio from that YouTube clip though.&lt;/p&gt;
&lt;p&gt;After a bit of googling^&lt;a class="footnote" href="#fn1" id="ffn1"&gt;1&lt;/a&gt;^ I found a command line tool called &lt;a href="https://rg3.github.io/youtube-dl/"&gt;youtube-dl&lt;/a&gt;. The tool allowed me to download the video as an &lt;code&gt;mp4&lt;/code&gt; with one simple command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;youtube-dl https://www.youtube.com/watch?v=4KwFuGtGU6c
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Once the mp4 was downloaded I needed to extract the audio from the &lt;code&gt;mp4&lt;/code&gt; file. Fortunately, &lt;code&gt;ffmpeg&lt;/code&gt; is a tool for just this type of exercise!&lt;/p&gt;
&lt;p&gt;I modified &lt;a href="https://stackoverflow.com/questions/9913032/ffmpeg-to-extract-audio-from-video"&gt;this answer from StackOverflow&lt;/a&gt; to meet my needs&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ffmpeg -i dodger_baseball.mp4 -ss 00:00:10 -t 00:00:9.0 -q:a 0 -vn -acodec copy dodger_baseball.aac
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This got me an &lt;code&gt;aac&lt;/code&gt; file, but I was going to need an &lt;code&gt;mp3&lt;/code&gt; to use in my Python script.&lt;/p&gt;
&lt;p&gt;Next, I used a &lt;a href="https://askubuntu.com/questions/35457/converting-aac-to-mp3-via-command-line"&gt;modified version of this suggestion&lt;/a&gt; to create write my own command&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ffmpeg -i dodger_baseball.aac -c:a libmp3lame -ac 2 -b:a 190k dodger_baseball.mp3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I could have probably combined these two steps, but … meh.&lt;/p&gt;
&lt;p&gt;OK. Now I have the famous Vin Scully saying the best five words on the planet.&lt;/p&gt;
&lt;p&gt;All that’s left to do is update the python script to play it. Using guidance from &lt;a href="https://raspberrypi.stackexchange.com/questions/7088/playing-audio-files-with-python"&gt;here&lt;/a&gt; I updated my &lt;code&gt;itfdb.py&lt;/code&gt; file from this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;month_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="nv"&gt;day_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="nv"&gt;hour_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="nv"&gt;minute_diff&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;:
   &lt;span class="nv"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;#ITFDB!!! The Dodgers will be playing {} at {}&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;.&lt;span class="nv"&gt;format&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;game&lt;/span&gt;.&lt;span class="nv"&gt;game_opponent&lt;/span&gt;, &lt;span class="nv"&gt;game&lt;/span&gt;.&lt;span class="nv"&gt;game_time&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
   &lt;span class="nv"&gt;sense&lt;/span&gt;.&lt;span class="nv"&gt;show_message&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;message&lt;/span&gt;, &lt;span class="nv"&gt;scroll_speed&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;.&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;To this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;month_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="nv"&gt;day_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="nv"&gt;hour_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="nv"&gt;minute_diff&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;:
   &lt;span class="nv"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;#ITFDB!!! The Dodgers will be playing {} at {}&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;.&lt;span class="nv"&gt;format&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;game&lt;/span&gt;.&lt;span class="nv"&gt;game_opponent&lt;/span&gt;, &lt;span class="nv"&gt;game&lt;/span&gt;.&lt;span class="nv"&gt;game_time&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
   &lt;span class="nv"&gt;sense&lt;/span&gt;.&lt;span class="nv"&gt;show_message&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;message&lt;/span&gt;, &lt;span class="nv"&gt;scroll_speed&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;.&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
   &lt;span class="nv"&gt;os&lt;/span&gt;.&lt;span class="nv"&gt;system&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;omxplayer -b /home/pi/Documents/python_projects/itfdb/dodger_baseball.mp3&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;However, what that does is play Vin’s silky smooth voice every minute for 10 minutes before game time. Music to my ears but my daughter was not a fan, and even my wife who LOVES Vin asked me to change it.&lt;/p&gt;
&lt;p&gt;One final tweak, and now it only plays at 5 minutes before game time and 1 minute before game time:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;month_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="nv"&gt;day_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="nv"&gt;hour_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="nv"&gt;minute_diff&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;:
   &lt;span class="nv"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;#ITFDB!!! The Dodgers will be playing {} at {}&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;.&lt;span class="nv"&gt;format&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;game&lt;/span&gt;.&lt;span class="nv"&gt;game_opponent&lt;/span&gt;, &lt;span class="nv"&gt;game&lt;/span&gt;.&lt;span class="nv"&gt;game_time&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
   &lt;span class="nv"&gt;sense&lt;/span&gt;.&lt;span class="nv"&gt;show_message&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;message&lt;/span&gt;, &lt;span class="nv"&gt;scroll_speed&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;.&lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;month_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="nv"&gt;day_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="nv"&gt;hour_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;minute_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;or&lt;/span&gt; &lt;span class="nv"&gt;minute_diff&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;:
   &lt;span class="nv"&gt;os&lt;/span&gt;.&lt;span class="nv"&gt;system&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;omxplayer -b /home/pi/Documents/python_projects/itfdb/dodger_baseball.mp3&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now, for the rest of the season, even though Vin isn’t calling the games, I’ll get to hear his voice letting me know, “It’s Time for Dodger Baseball!!!”&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;[Actually, it was an embarrassing amount &lt;a href="#ffn1"&gt;↩&lt;/a&gt;]{#fn1}&lt;/li&gt;
&lt;/ol&gt;</content><category term="Raspberry Pi"></category><category term="python"></category><category term="Raspberry Pi"></category></entry><entry><title>Using MP4Box to concatenate many .h264 files into one MP4 file: revisited</title><link href="https://www.ryancheley.com/using-mp4box-to-concatenate-many-h264-files-into-one-mp4-file-revisited.html" rel="alternate"></link><published>2018-02-10T15:20:00+01:00</published><updated>2018-02-10T15:20:00+01:00</updated><author><name>ryan</name></author><id>tag:www.ryancheley.com,2018-02-10:/using-mp4box-to-concatenate-many-h264-files-into-one-mp4-file-revisited.html</id><summary type="html">&lt;p&gt;In my last &lt;a href="/using-mp4box-to-concatenate-many-h264-files-into-one-mp4-file.html"&gt;post&lt;/a&gt; I wrote out the steps that I was going to use to turn a ton of &lt;code&gt;.h264&lt;/code&gt; files into one &lt;code&gt;mp4&lt;/code&gt; file with the use of &lt;code&gt;MP4Box&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Before outlining my steps I said, “The method below works but I’m sure that there is a better …&lt;/p&gt;</summary><content type="html">&lt;p&gt;In my last &lt;a href="/using-mp4box-to-concatenate-many-h264-files-into-one-mp4-file.html"&gt;post&lt;/a&gt; I wrote out the steps that I was going to use to turn a ton of &lt;code&gt;.h264&lt;/code&gt; files into one &lt;code&gt;mp4&lt;/code&gt; file with the use of &lt;code&gt;MP4Box&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Before outlining my steps I said, “The method below works but I’m sure that there is a better way to do it.”&lt;/p&gt;
&lt;p&gt;Shortly after posting that I decided to find that better way. Turns out, ~~it wasn’t really that much more work~~ it was much harder than originally thought.&lt;/p&gt;
&lt;p&gt;The command below is a single line and it will create a text file (com.txt) and then execute it as a bash script:&lt;/p&gt;
&lt;p&gt;~~&lt;code&gt;(echo '#!/bin/sh'; for i in *.h264; do if [ "$i" -eq 1 ]; then echo -n " -add $i"; else echo -n " -cat $i"; fi; done; echo -n " hummingbird.mp4") &amp;gt; /Desktop/com.txt | chmod +x /Desktop/com.txt | ~/Desktop/com.txt&lt;/code&gt;~~&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#!/bin/sh&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;MP4Box&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;h264&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;index&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;${!&lt;/span&gt;&lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;@&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt; &amp;quot;$index&amp;quot; -eq 1 &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot; -add ${array[index]}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot; -cat ${array[index]}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fi&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;done&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;&amp;quot; hummingbird.mp4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chmod&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;txt&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Next you execute the script with&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./com.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;OK, but what is it doing? The parentheses surround a set of echo commands that output to com.txt. I’m using a for loop with an if statement. The reason I can’t do a straight for loop is because the first &lt;code&gt;h264&lt;/code&gt; file used in &lt;code&gt;MP4Box&lt;/code&gt; needs to have the &lt;code&gt;-add&lt;/code&gt; flag while all of the others need the &lt;code&gt;-cat&lt;/code&gt; flag.&lt;/p&gt;
&lt;p&gt;Once the file is output to the &lt;code&gt;com.txt&lt;/code&gt; file (on the Desktop) I pipe it to the &lt;code&gt;chmod +x&lt;/code&gt; command to change it’s mode to make it executable.&lt;/p&gt;
&lt;p&gt;Finally, I pipe that to a command to run the file &lt;code&gt;~/Desktop/com.txt&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I was pretty stoked when I figured it out and was able to get it to run.&lt;/p&gt;
&lt;p&gt;The next step will be to use it for the hundreds of h264 files that will be output from my hummingbird camera that I just installed today.&lt;/p&gt;
&lt;p&gt;I’ll have a post on that in the next couple of days.&lt;/p&gt;</content><category term="Raspberry Pi"></category><category term="Bash"></category><category term="python"></category><category term="Shell Script"></category></entry><entry><title>Using MP4Box to concatenate many .h264 files into one MP4 file</title><link href="https://www.ryancheley.com/using-mp4box-to-concatenate-many-h264-files-into-one-mp4-file.html" rel="alternate"></link><published>2018-02-08T05:25:00+01:00</published><updated>2018-02-08T05:25:00+01:00</updated><author><name>ryan</name></author><id>tag:www.ryancheley.com,2018-02-08:/using-mp4box-to-concatenate-many-h264-files-into-one-mp4-file.html</id><summary type="html">&lt;p&gt;The general form of the concatenate command for &lt;a href="https://gpac.wp.imt.fr/mp4box/" title="MP4Box"&gt;MP4Box&lt;/a&gt; is:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MP4Box -add &amp;lt;filename&amp;gt;.ext -cat &amp;lt;filename&amp;gt;.ext output.ext&lt;/code&gt;^&lt;a class="footnote" href="#fn1" id="ffn1"&gt;1&lt;/a&gt;^&lt;/p&gt;
&lt;p&gt;When you have more than a couple of output files, you’re going to want to automate that &lt;code&gt;-cat&lt;/code&gt; part as much as possible because let’s face it, writing …&lt;/p&gt;</summary><content type="html">&lt;p&gt;The general form of the concatenate command for &lt;a href="https://gpac.wp.imt.fr/mp4box/" title="MP4Box"&gt;MP4Box&lt;/a&gt; is:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MP4Box -add &amp;lt;filename&amp;gt;.ext -cat &amp;lt;filename&amp;gt;.ext output.ext&lt;/code&gt;^&lt;a class="footnote" href="#fn1" id="ffn1"&gt;1&lt;/a&gt;^&lt;/p&gt;
&lt;p&gt;When you have more than a couple of output files, you’re going to want to automate that &lt;code&gt;-cat&lt;/code&gt; part as much as possible because let’s face it, writing out that statement even more than a couple of times will get really old really fast.&lt;/p&gt;
&lt;p&gt;The method below &lt;em&gt;works&lt;/em&gt; but I’m sure that there is a better way to do it.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;echo out the command you want to run. In this case:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;(echo -n "MP4Box "; for i in *.h264; do echo -n " -cat $i"; done; echo -n " hummingbird.mp4") &amp;gt;&amp;gt; com.txt&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Edit the file &lt;code&gt;com.txt&lt;/code&gt; created in (1) so that you can change the first &lt;code&gt;-cat&lt;/code&gt; to &lt;code&gt;-add&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;vim com.txt&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;While still in &lt;code&gt;vim&lt;/code&gt; editing the &lt;code&gt;com.txt&lt;/code&gt; file add the &lt;code&gt;#!/bin/sh&lt;/code&gt; to the first line. When finished, exit vim^&lt;a class="footnote" href="#fn2" id="ffn2"&gt;2&lt;/a&gt;^&lt;/li&gt;
&lt;li&gt;Change the mode of the file so it can run&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;chmod +x com.txt&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Run the file:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;./com.txt&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Why am I doing all of this? I have a Raspberry Pi with a Camera attachment and a motion sensor. I’d like to watch the hummingbirds that come to my hummingbird feeder with it for a day or two and get some sweet video. We’ll see how it goes.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;[The &lt;code&gt;-add&lt;/code&gt; will add the \&amp;lt;filename&gt; to the output file while the &lt;code&gt;-cat&lt;/code&gt; will add any other files to the output file (all while not overwriting the output file so that the files all get streamed together). &lt;a href="#ffn1"&gt;↩&lt;/a&gt;]{#fn1}&lt;/li&gt;
&lt;li&gt;[I’m sure there’s an xkcd comic about this, but I just can’t find it! &lt;a href="#ffn2"&gt;↩&lt;/a&gt;]{#fn2}&lt;/li&gt;
&lt;/ol&gt;</content><category term="Raspberry Pi"></category><category term="automation"></category><category term="Bash"></category><category term="python"></category><category term="Shell Script"></category></entry></feed>